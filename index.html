<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÏπµÌÖåÏùºÏßÄÏßÄ CKTL.GG</title>
    <link rel="icon" href="favicon.png" type="image/png">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root { 
            --primary: #C2DA6B; 
            --primary-dark: #adc45b;
            --bg: #f7f8f2; 
        }
        
        body { font-family: 'Pretendard', -apple-system, sans-serif; background: var(--bg); padding: 20px; color: #2f3542; line-height: 1.5; }
        .container { max-width: 600px; margin: 0 auto; }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in { animation: fadeInUp 0.4s ease-out forwards; }

        /* --- Í≥µÌÜµ Ïª¥Ìè¨ÎÑåÌä∏ --- */
        #toast {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            background: rgba(47, 53, 66, 0.9); color: white; padding: 12px 25px;
            border-radius: 30px; font-size: 0.9rem; font-weight: bold; z-index: 1000;
            opacity: 0; transition: opacity 0.3s, bottom 0.3s; pointer-events: none;
        }
        #toast.show { opacity: 1; bottom: 50px; }

        .header-section { text-align: center; margin-bottom: 25px; }
        .main-logo { max-width: 200px; width: 70%; height: auto; margin-bottom: 8px; }
        .main-title { margin: 0; font-size: 0.9rem; font-weight: 500; color: #747d8c; letter-spacing: 1px; text-transform: uppercase; }

        .search-filter-box { background: white; padding: 15px; border-radius: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 12px; }
        .search-input { width: 100%; padding: 12px; border: 2px solid #eee; border-radius: 12px; box-sizing: border-box; font-size: 1rem; outline: none; transition: 0.3s; margin-bottom: 12px; }
        .search-input:focus { border-color: var(--primary); }
        
        .category-tabs { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 8px; white-space: nowrap; scrollbar-width: none; }
        .category-tabs::-webkit-scrollbar { display: none; }
        .cat-tab { padding: 7px 15px; border-radius: 15px; background: #f1f2f6; border: none; font-size: 0.85rem; cursor: pointer; color: #57606f; transition: 0.2s; }
        .cat-tab.active { background: #2f3542; color: white; font-weight: bold; }

        #ingredient-list { 
            background: white; padding: 12px; border-radius: 20px; box-shadow: inset 0 2px 5px rgba(0,0,0,0.03);
            max-height: 155px; overflow-y: auto; text-align: center; display: flex; flex-wrap: wrap; justify-content: center; gap: 6px;
        }
        .ingredient-btn { padding: 8px 14px; border-radius: 20px; border: 1px solid #ddd; cursor: pointer; background: white; transition: 0.2s; font-size: 0.85rem; }
        .ingredient-btn.active { background: var(--primary); color: #4a542a; border-color: var(--primary-dark); font-weight: bold; }

        .selected-container { margin: 20px 0; display: none; } 
        .selected-header { display: flex; justify-content: space-between; align-items: center; margin: 0 5px 10px 5px; }
        .reset-btn { background: none; border: none; color: #ff4757; font-size: 0.75rem; cursor: pointer; font-weight: bold; text-decoration: underline; }

        .selected-scroll { display: flex; gap: 15px; overflow-x: auto; padding: 10px 5px; scrollbar-width: none; }
        .selected-item { 
            flex: 0 0 105px; width: 105px; height: 130px; background: white; border-radius: 18px; 
            box-shadow: 0 6px 15px rgba(0,0,0,0.08); text-align: center; position: relative;
            padding: 10px; box-sizing: border-box; display: flex; flex-direction: column; align-items: center; justify-content: center;
            cursor: pointer; transition: transform 0.2s;
        }
        .selected-item:active { transform: scale(0.95); }
        .selected-item img { width: 60px; height: 60px; object-fit: contain; margin-bottom: 8px; }
        .selected-item span { font-size: 0.85rem; font-weight: bold; color: #2f3542; word-break: keep-all; line-height: 1.2; }
        .remove-tag { 
            position: absolute; top: -6px; right: -6px; background: #ff4757; color: white; 
            width: 24px; height: 24px; border-radius: 50%; font-size: 15px; border: 2px solid white; cursor: pointer; font-weight: bold;
            z-index: 10; display: flex; align-items: center; justify-content: center;
        }
        
        .section-title { margin: 25px 0 10px 5px; font-size: 1.1rem; display: flex; align-items: center; gap: 8px; font-weight: bold; }
        .section-divider { border: 0; height: 1px; background: #ddd; margin: 30px 0 20px 0; }
        .cocktail-item { background: white; padding: 15px; border-radius: 15px; margin-top: 15px; cursor: pointer; display: flex; gap: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); transition: 0.2s; opacity: 0; }
        .list-thumb { width: 70px; height: 70px; border-radius: 12px; object-fit: cover; background: #eee; flex-shrink: 0; }
        
        .cocktail-info { flex-grow: 1; display: flex; flex-direction: column; width: 0; } 
        .gauge-container { background: #eee; height: 8px; border-radius: 4px; overflow: hidden; margin-top: 8px; width: 100%; } 
        .gauge-bar { height: 100%; width: 0; transition: width 1.2s cubic-bezier(0.22, 1, 0.36, 1); }
        .matching-text { font-size: 0.75em; font-weight: bold; }

        .match-badge { font-size: 0.7rem; padding: 2px 6px; border-radius: 4px; margin-left: 6px; vertical-align: middle; background: #e3f2fd; color: #1976d2; border: 1px solid #1976d2; font-weight: bold; }

        .footer-banner { margin-top: 40px; margin-bottom: 20px; text-align: center; }
        .footer-banner img { width: 100%; display: block; border: none; }

        /* --- ‚ú® ÎπÑÏú® Í∑∏ÎûòÌîÑ Ïä§ÌÉÄÏùº --- */
        .m-visual-section {
            display: flex; align-items: flex-end; justify-content: center; gap: 20px; margin-bottom: 25px;
        }
        .glass-container {
            width: 95px; height: 140px; position: relative; border: 3px solid #2f3542;
            border-top: none; border-radius: 4px 4px 22px 22px;
            overflow: hidden; background: #fff; 
            display: flex; flex-direction: column;
        }
        .glass-layer {
            width: 100%; transition: height 1s ease-out; display: flex; flex-direction: column; align-items: center; justify-content: center;
            font-size: 9px; font-weight: bold; color: #2f3542; line-height: 1.1;
            overflow: hidden; white-space: nowrap; padding: 2px 4px; box-sizing: border-box;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        .glass-layer:last-child { border-bottom: none; }

        .color-0 { background-color: #ffeadb; } .color-1 { background-color: #e2f5ff; }
        .color-2 { background-color: #ebf7d4; } .color-3 { background-color: #fff9db; }
        .color-4 { background-color: #f3e5f5; } .color-5 { background-color: #ffebee; }

        /* --- ÌåùÏóÖ Ïä§ÌÉÄÏùº --- */
        #modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 999; backdrop-filter: blur(5px); opacity: 0; transition: opacity 0.3s ease; }
        #modal-overlay.show { display: block; opacity: 1; }
        
        #modal { 
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, 60%); 
            background: white; padding: 40px 25px 30px 25px; border-radius: 35px; z-index: 1000; 
            width: 90%; max-width: 480px; text-align: center; max-height: 85vh; overflow-y: auto; 
            box-shadow: 0 25px 60px rgba(0,0,0,0.35); opacity: 0; transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.1), opacity 0.3s ease; 
        }
        #modal.show { display: block; transform: translate(-50%, -50%); opacity: 1; }
        
        .close-x { position: absolute; top: 20px; right: 20px; font-size: 32px; color: #d1d8e0; cursor: pointer; line-height: 1; transition: 0.2s; z-index: 1001; }
        .close-x:hover { color: #2f3542; }

        #m-name { border-bottom: 4px solid var(--primary); display: inline-block; padding-bottom: 5px; margin-bottom: 20px; font-size: 1.6rem; letter-spacing: -0.5px; }
        #m-img { width: 160px; height: 160px; object-fit: contain; margin: 0; filter: drop-shadow(0 10px 15px rgba(0,0,0,0.1)); }
        
        /* Î∞ïÏä§ Î†àÏù¥ÏïÑÏõÉ Ï∂îÍ∞Ä */
        .label-text { font-size: 0.8rem; font-weight: bold; color: #a4b0be; text-align: left; margin-top: 15px; padding-left: 5px; text-transform: uppercase; }
        .m-desc-box { text-align: left; background: #fdfdfd; border-left: 5px solid #d1d8e0; padding: 15px; border-radius: 12px; font-size: 0.95rem; margin-top: 8px; color: #57606f; line-height: 1.6; }
        .m-recipe-box { text-align: left; background: #f9f9f4; border-left: 5px solid var(--primary); padding: 18px; border-radius: 12px; font-size: 1rem; white-space: pre-wrap; line-height: 1.7; margin-top: 8px; }

        .recommend-title { font-size: 0.95rem; font-weight: bold; color: #747d8c; margin-top: 30px; text-align: left; padding-left: 5px; }
        .recommend-list { display: flex; flex-direction: column; gap: 12px; margin-top: 12px; }
        .mini-card { display: flex; align-items: center; gap: 15px; background: #f1f2f6; padding: 12px; border-radius: 15px; cursor: pointer; text-align: left; transition: 0.2s; }
        .mini-card img { width: 50px; height: 50px; border-radius: 10px; object-fit: cover; background: white; }
        .mini-card span { font-size: 1rem; font-weight: bold; color: #2f3542; }
    </style>
</head>
<body>
<div class="container">
    <header class="header-section">
        <img src="logo.png" alt="Logo" class="main-logo" onerror="this.style.display='none'">
        <h1 class="main-title">My Smart Bar</h1>
    </header>

    <div class="search-filter-box">
        <input type="text" id="ing-search" class="search-input" placeholder="üîç Ïû¨Î£å Í≤ÄÏÉâ (Ï¥àÏÑ± Í∞ÄÎä•)..." oninput="filterIngredients()">
        <div class="category-tabs" id="category-tabs"></div>
    </div>
    <div id="ingredient-list"></div>
    <div class="selected-container" id="selected-box">
        <div class="selected-header">
            <div style="font-size: 0.85rem; font-weight: bold; color: #747d8c;">üìç Î≥¥Ïú† Ï§ëÏù∏ Ïû¨Î£å</div>
            <button class="reset-btn" onclick="clearSelected()">Ï†ÑÏ≤¥ ÏÇ≠Ï†ú</button>
        </div>
        <div class="selected-scroll" id="selected-list"></div>
    </div>
    <div id="result-list"></div>
    <div class="footer-banner fade-in">
        <img src="banner.png" alt="" onerror="this.parentElement.style.display='none'">
    </div>
</div>

<div id="toast">Î™®Îì† Ïû¨Î£åÎ•º ÏßÄÏõ†Ïñ¥Ïöî</div>
<div id="modal-overlay" onclick="closeModal()"></div>
<div id="modal">
    <span class="close-x" onclick="closeModal()">&times;</span>
    <h2 id="m-name"></h2>
    <div id="m-ings" style="text-align: left; margin-bottom: 15px; display: flex; flex-wrap: wrap; gap: 8px; justify-content: center;"></div>
    <div id="m-content"></div>
</div>

<script>
    const DEFAULT_IMG = "default.png"; 
    let recipes = [], ingredientDocs = {}, selected = new Set();
    let currentCategory = 'Ï†ÑÏ≤¥', categories = new Set(['Ï†ÑÏ≤¥']);
    let ingredientUsage = {};

    function getChosung(str) {
        const cho = ["„Ñ±","„Ñ≤","„Ñ¥","„Ñ∑","„Ñ∏","„Ñπ","„ÖÅ","„ÖÇ","„ÖÉ","„ÖÖ","„ÖÜ","„Öá","„Öà","„Öâ","„Öä","„Öã","„Öå","„Öç","„Öé"];
        let result = "";
        for(let i=0; i<str.length; i++) {
            let code = str.charCodeAt(i) - 44032;
            if(code > -1 && code < 11172) result += cho[Math.floor(code/588)];
            else result += str.charAt(i);
        }
        return result;
    }

    async function autoLoad(file, type) {
        try {
            const res = await fetch(file);
            if(!res.ok) return;
            const ab = await res.arrayBuffer();
            const wb = XLSX.read(new Uint8Array(ab), {type:'array'});
            const json = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);
            
            if(type === 'r') {
                recipes = json.map(row => ({...row, items: row['Ïû¨Î£å']?.split(',').map(i=>i.trim()) || []}));
                calculateUsage();
            } else {
                json.forEach(row => { 
                    if(row['Ïû¨Î£åÎ™Ö']) {
                        const name = row['Ïû¨Î£åÎ™Ö'].trim();
                        ingredientDocs[name] = row; 
                        if(row['Ïπ¥ÌÖåÍ≥†Î¶¨']) categories.add(row['Ïπ¥ÌÖåÍ≥†Î¶¨'].trim());
                    }
                });
                renderCategoryTabs();
            }
            filterIngredients();
        } catch(e) { console.log("Î°úÎìú Ï§ë..."); }
    }

    function calculateUsage() {
        ingredientUsage = {};
        recipes.forEach(r => { r.items.forEach(item => { ingredientUsage[item] = (ingredientUsage[item] || 0) + 1; }); });
    }

    function renderCategoryTabs() {
        const tabContainer = document.getElementById('category-tabs');
        tabContainer.innerHTML = '';
        Array.from(categories).forEach(cat => {
            const btn = document.createElement('button');
            btn.className = `cat-tab ${currentCategory === cat ? 'active' : ''}`;
            btn.innerText = cat;
            btn.onclick = () => { currentCategory = cat; renderCategoryTabs(); filterIngredients(); };
            tabContainer.appendChild(btn);
        });
    }

    function filterIngredients() {
        const query = document.getElementById('ing-search').value.toLowerCase();
        const queryCho = getChosung(query);
        const container = document.getElementById('ingredient-list');
        container.innerHTML = '';
        
        const sortedIngs = Object.keys(ingredientDocs).sort((a, b) => {
            if (selected.has(a) !== selected.has(b)) return selected.has(a) ? -1 : 1;
            const isRepA = (a === ingredientDocs[a]?.Ïπ¥ÌÖåÍ≥†Î¶¨);
            const isRepB = (b === ingredientDocs[b]?.Ïπ¥ÌÖåÍ≥†Î¶¨);
            if (isRepA !== isRepB) return isRepA ? -1 : 1;
            const countA = ingredientUsage[a] || 0;
            const countB = ingredientUsage[b] || 0;
            if (countA !== countB) return countB - countA;
            return a.localeCompare(b);
        });

        sortedIngs.forEach(ing => {
            const doc = ingredientDocs[ing];
            const isMatch = ing.toLowerCase().includes(query) || getChosung(ing).includes(queryCho);
            const isRepresentative = (ing === doc['Ïπ¥ÌÖåÍ≥†Î¶¨']);
            if (isMatch) {
                if (currentCategory === 'Ï†ÑÏ≤¥') {
                    if (!isRepresentative || selected.has(ing)) createIngBtn(ing, isRepresentative);
                } else if (currentCategory === doc['Ïπ¥ÌÖåÍ≥†Î¶¨']) {
                    createIngBtn(ing, isRepresentative);
                }
            }
        });

        function createIngBtn(ing, isRepresentative) {
            const btn = document.createElement('button');
            btn.className = `ingredient-btn ${selected.has(ing) ? 'active' : ''}`;
            btn.innerText = (isRepresentative && currentCategory !== 'Ï†ÑÏ≤¥') ? `‚≠ê ${ing}` : ing;
            btn.onclick = () => toggleIngredient(ing);
            container.appendChild(btn);
        }
        renderSelected(); 
    }

    function toggleIngredient(ing) {
        selected.has(ing) ? selected.delete(ing) : selected.add(ing);
        filterIngredients();
        renderRecipes();
    }

    function clearSelected() {
        selected.clear();
        filterIngredients();
        renderRecipes();
        showToast();
    }

    function showToast() {
        const t = document.getElementById('toast');
        t.classList.add('show');
        setTimeout(() => t.classList.remove('show'), 2000);
    }

    function renderSelected() {
        const box = document.getElementById('selected-box'), list = document.getElementById('selected-list');
        list.innerHTML = '';
        if (selected.size === 0) { box.style.display = 'none'; return; }
        box.style.display = 'block';
        selected.forEach(ing => {
            const item = document.createElement('div');
            item.className = 'selected-item fade-in';
            item.onclick = () => showIngredientDetail(ing);
            item.innerHTML = `
                <button class="remove-tag" onclick="event.stopPropagation(); toggleIngredient('${ing}')">√ó</button>
                <img src="${ingredientDocs[ing]?.Ïù¥ÎØ∏ÏßÄ || DEFAULT_IMG}" onerror="this.src='${DEFAULT_IMG}'">
                <span>${ing}</span>`;
            list.appendChild(item);
        });
    }

    function renderRecipes() {
        const resDiv = document.getElementById('result-list');
        resDiv.innerHTML = '';
        if(selected.size === 0) return;
        const selectedCats = new Set();
        selected.forEach(ing => { if(ingredientDocs[ing]?.Ïπ¥ÌÖåÍ≥†Î¶¨) selectedCats.add(ingredientDocs[ing].Ïπ¥ÌÖåÍ≥†Î¶¨); });
        const matches = [];
        recipes.forEach(r => {
            let matchCount = 0, score = 0, hasStrictBrand = false;
            r.items.forEach(reqItem => {
                if (selected.has(reqItem)) { matchCount++; score += 10; if (reqItem !== ingredientDocs[reqItem]?.Ïπ¥ÌÖåÍ≥†Î¶¨) hasStrictBrand = true; }
                else if (selectedCats.has(reqItem)) { matchCount++; score += 5; }
            });
            if (matchCount > 0) matches.push({ ...r, matchCount, score, hasStrictBrand });
        });
        matches.sort((a, b) => b.score - a.score || (b.matchCount/b.items.length) - (a.matchCount/a.items.length));
        const perfectMatches = matches.filter(m => m.matchCount === m.items.length);
        const partialMatches = matches.filter(m => m.matchCount !== m.items.length);

        if (perfectMatches.length > 0) {
            resDiv.appendChild(Object.assign(document.createElement('h3'), {className: 'section-title', innerHTML: `‚ú® Ï†úÏ°∞ Í∞ÄÎä• (${perfectMatches.length})`}));
            perfectMatches.forEach((r, i) => resDiv.appendChild(createCard(r, i, true)));
        }
        if (partialMatches.length > 0) {
            if(perfectMatches.length > 0) resDiv.appendChild(Object.assign(document.createElement('hr'), {className: 'section-divider'}));
            resDiv.appendChild(Object.assign(document.createElement('h3'), {className: 'section-title', style: "color:#a4b0be", innerText: "üí° Ïù¥Îü∞ Î†àÏãúÌîºÎèÑ ÏûàÏñ¥Ïöî"}));
            partialMatches.forEach((r, i) => resDiv.appendChild(createCard(r, i + 100, false)));
        }
    }

    function createCard(r, idx, isPerfect) {
        const per = Math.round((r.matchCount / r.items.length) * 100);
        const card = document.createElement('div');
        card.className = 'cocktail-item fade-in';
        card.onclick = () => showDetail(r);
        card.innerHTML = `
            <img src="${r.Ïù¥ÎØ∏ÏßÄ || DEFAULT_IMG}" class="list-thumb" onerror="this.src='${DEFAULT_IMG}'">
            <div class="cocktail-info">
                <div style="display:flex; justify-content:space-between; align-items: baseline;">
                    <strong>${r.Ïù¥Î¶Ñ}${r.hasStrictBrand ? '<span class="match-badge">Î∏åÎûúÎìú ÏùºÏπò</span>' : ''}</strong> 
                    <small style="color:#a4b0be;">${r.ÎÇúÏù¥ÎèÑ || ""}</small>
                </div>
                <div style="font-size:0.8em; color:#747d8c; margin:4px 0;">${r.Ïû¨Î£å}</div>
                <div class="matching-text" style="color:${isPerfect ? 'var(--primary-dark)' : '#ffa502'}">${isPerfect ? '‚úÖ Ï§ÄÎπÑ ÏôÑÎ£å' : `Ïû¨Î£å ${r.matchCount}/${r.items.length} Î≥¥Ïú†`}</div>
                <div class="gauge-container"><div id="g-${idx}" class="gauge-bar" style="background:${isPerfect ? 'var(--primary)' : '#dfe4ea'}"></div></div>
            </div>`;
        setTimeout(() => { if(document.getElementById(`g-${idx}`)) document.getElementById(`g-${idx}`).style.width = per + '%'; }, 150);
        return card;
    }

    function showDetail(r) {
        const selectedCats = new Set();
        selected.forEach(ing => { if(ingredientDocs[ing]?.Ïπ¥ÌÖåÍ≥†Î¶¨) selectedCats.add(ingredientDocs[ing].Ïπ¥ÌÖåÍ≥†Î¶¨); });

        document.getElementById('m-name').innerText = r.Ïù¥Î¶Ñ;
        document.getElementById('m-ings').innerHTML = r.items.map(i => {
            const isStrict = selected.has(i), isCat = selectedCats.has(i);
            let style = `background:#eee; color:#999;`;
            if(isStrict) style = `background:var(--primary); color:#4a542a; border:2px solid var(--primary-dark); font-weight:bold;`;
            else if(isCat) style = `background:#dff9fb; color:#130f40; border:1px solid #7ed6df;`;
            return `<span onclick="showIngredientDetail('${i}')" style="cursor:pointer; padding:6px 14px; border-radius:12px; font-size:0.9em; ${style}">${i}</span>`;
        }).join('');

        const lines = r.Î†àÏãúÌîº?.split('\n') || [];
        let layersHtml = '', totalUnit = 0; const itemsToDraw = [];
        lines.forEach((line) => {
            const match = line.match(/([\d.]+)\s*(oz|ml|part|parts|dash)/i);
            if (match) {
                const val = parseFloat(match[1]);
                const unit = match[2];
                const name = line.split(/[0-9]/)[0].trim();
                itemsToDraw.push({ name, val, unit }); 
                totalUnit += val;
            }
        });

        if (totalUnit > 0) {
            layersHtml = `<div class="glass-container">`;
            itemsToDraw.forEach((item, idx) => {
                layersHtml += `<div class="glass-layer color-${idx % 6}" style="height: ${(item.val / totalUnit) * 100}%"><span>${item.name}</span><span>${item.val}${item.unit}</span></div>`;
            });
            layersHtml += `</div>`;
        }

        // ÌåùÏóÖ ÎÇ¥Ïö© Ï°∞Î¶Ω (ÏÑ§Î™Ö Ïπ∏ Î∂ÑÎ¶¨)
        document.getElementById('m-content').innerHTML = `
            <div class="m-visual-section">
                <img id="m-img" src="${r.Ïù¥ÎØ∏ÏßÄ || DEFAULT_IMG}" onerror="this.src='${DEFAULT_IMG}'">
                ${layersHtml}
            </div>
            ${r.ÏÑ§Î™Ö ? `<div class="label-text">ABOUT</div><div class="m-desc-box">${r.ÏÑ§Î™Ö}</div>` : ''}
            <div class="label-text">RECIPE</div>
            <div class="m-recipe-box">${r.Î†àÏãúÌîº || 'Ï†ïÎ≥¥Í∞Ä ÏóÜÏäµÎãàÎã§.'}</div>
        `;
        openModal();
    }

    function showIngredientDetail(ing) {
        const doc = ingredientDocs[ing] || Object.values(ingredientDocs).find(d => d.Ïπ¥ÌÖåÍ≥†Î¶¨ === ing);
        if(!doc) {
            document.getElementById('m-name').innerText = ing;
            document.getElementById('m-content').innerHTML = `<div class="m-recipe-box">Ï†ïÎ≥¥Í∞Ä ÏóÜÏäµÎãàÎã§.</div>`;
            openModal(); return;
        }
        document.getElementById('m-name').innerText = doc.Ïû¨Î£åÎ™Ö;
        document.getElementById('m-ings').innerHTML = `<span style="background:#2f3542; color:white; padding:6px 18px; border-radius:25px; font-size:0.9em;">${doc.Ïπ¥ÌÖåÍ≥†Î¶¨ || 'Í∏∞ÌÉÄ'}</span>`;
        let html = `<div class="m-visual-section"><img id="m-img" src="${doc.Ïù¥ÎØ∏ÏßÄ || DEFAULT_IMG}" onerror="this.src='${DEFAULT_IMG}'"></div>
                    <div class="label-text">INGREDIENT INFO</div><div class="m-desc-box">${doc.ÏÑ§Î™Ö || 'ÏÑ§Î™ÖÏù¥ Ï§ÄÎπÑ Ï§ëÏûÖÎãàÎã§.'}</div>`;
        const recommends = recipes.filter(r => r.items.includes(doc.Ïû¨Î£åÎ™Ö) || r.items.includes(doc.Ïπ¥ÌÖåÍ≥†Î¶¨)).slice(0, 3);
        if(recommends.length > 0) {
            html += `<div class="recommend-title">üçπ Ï∂îÏ≤ú Î†àÏãúÌîº</div><div class="recommend-list">`;
            recommends.forEach(r => {
                html += `<div class="mini-card" onclick="showDetail(${JSON.stringify(r).replace(/"/g, '&quot;')})"><img src="${r.Ïù¥ÎØ∏ÏßÄ || DEFAULT_IMG}" onerror="this.src='${DEFAULT_IMG}'"><span>${r.Ïù¥Î¶Ñ}</span></div>`;
            });
            html += `</div>`;
        }
        document.getElementById('m-content').innerHTML = html;
        openModal();
    }

    function openModal() {
        const m = document.getElementById('modal'), o = document.getElementById('modal-overlay');
        m.style.display = o.style.display = 'block';
        m.scrollTop = 0;
        setTimeout(() => { m.classList.add('show'); o.classList.add('show'); }, 10);
    }

    function closeModal() {
        const m = document.getElementById('modal'), o = document.getElementById('modal-overlay');
        m.classList.remove('show'); o.classList.remove('show');
        setTimeout(() => m.style.display = o.style.display = 'none', 300);
    }
    
    window.onload = () => { autoLoad('cocktails.xlsx', 'r'); autoLoad('ingredients.xlsx', 'i'); };
</script>
</body>
</html>